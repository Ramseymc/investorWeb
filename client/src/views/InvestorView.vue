<template>
  <div class="about">
    <!-- Header row with Create button and Search Bar -->
    <br />
    <v-row>
      <v-col cols="3">
        <h1>View Investors</h1>
      </v-col>
      <v-col cols="4">
        <!-- Search -->
        <v-text-field
          prepend-icon="mdi-magnify"
          placholder="Search"
          label="Search"
          v-model="searchInvestors"
        ></v-text-field>
      </v-col>
      <v-col cols="4">
        <!-- </v-col>
        <v-col cols="3"> -->
        <v-btn-toggle v-model="icon" borderless>
          <v-btn value="home" color="green" @click="home">

            <v-icon right> mdi-home </v-icon>
          </v-btn>

          <v-btn value="refresh" color="secondary" @click="refresh">
            <span>Refresh</span>

            <v-icon right> mdi-refresh </v-icon>
          </v-btn>

          <v-btn value="create" color="primary" @click="create">
            <span class="hidden-sm-and-down">Create</span>

            <v-icon right> mdi-account-plus </v-icon>
          </v-btn>

          <!-- <v-btn value="right">
          <span class="hidden-sm-and-down">Right</span>

          <v-icon right>
            mdi-format-align-right
          </v-icon>
        </v-btn>

        <v-btn value="justify">
          <span class="hidden-sm-and-down">Justify</span>

          <v-icon right>
            mdi-format-align-justify
          </v-icon>
        </v-btn> -->
        </v-btn-toggle>
      </v-col>
    </v-row>

    <!-- Table -->
    <v-simple-table v-resize="onResize" align="center" justify="center">
      <template v-slot:default>
        <thead>
          <tr>
            <th class="text-left">Investor Code</th>
            <th class="text-left">View</th>
            <th class="text-left">Name</th>
            <th class="text-left">Email</th>
            <th class="text-left">ID</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="investor in investorsFiltered" :key="investor.investor_id">
            <td>
              <v-btn :id="investor.investor_id" text @click="viewInvestor">{{
                investor.investor_acc_number
              }}</v-btn>

              <!-- <a target="_blank"
                 style="text-decoration: none"
                 v-on:click="openInvestmentView"
                 :id="investor.investor_id"
           >{{ investor.investor_acc_number }} </a> -->
            </td>
            <!-- add a link to investmentView.vue - might change on Wayne's opinion  -->
            <td> <v-btn :id="investor.investor_id" text @click="viewInvestments" color="blue">
              Investments
              </v-btn></td>
            <td>
             
              {{ investor.investor_name }} {{ investor.investor_surname }}
      
            </td>
            <td>{{ investor.investor_email }}</td>
            <td>{{ investor.investor_id_number }}</td>
          </tr>
        </tbody>
      </template>
    </v-simple-table>

    <InvestmentView
      v-if="openInvestmentViewForm"
      :dialog="openInvestmentViewForm"
      :investorId="investorId"
      @closeForm="closeForm"
    />
    <InvestorUpdate
      v-if="openInvestmentViewForm"
      :dialog="openInvestmentViewForm"
      :investorId="investorId"
      @closeForm="closeForm"
    />
  </div>
</template>

<script>
import axios from "axios";
import InvestmentView from "../views/InvestmentView.vue";
import InvestorUpdate from "../components/InvestmentUpdate.vue";
let url = process.env.VUE_APP_BASEURL;

export default {
  name: "investorview",
  components: {
    InvestmentView,
    InvestorUpdate
  },

  metaInfo: {
    title: "Investor View",
    titleTemplate: "CPC - %s",
    meta: [
      {
        name: `description`,
        content: `About CPC here.`,
      },
    ],
    htmlAttrs: {
      lang: "en",
      amp: true,
    },
  },

  data() {
    return {
      // investor data
      InvestorList: [],
      searchInvestors: "",
      investorId: "",
      SelectedInvestorId: "",
      openInvestmentViewForm: false,
      text: "center",
      icon: "justify",

      windowSize: {
        x: 0,
        y: 0,
      },
    };
  },

  async mounted() {
    this.getAllInvestors();
    this.onResize();
  },

  computed: {
    pageUrl() {
      return "page.html?id=" + this.investorId;
    },
    investorsFiltered() {
      if (this.searchInvestors === "") {
        console.log("InvestorList = ", this.InvestorList);
        return this.InvestorList;
      } else {
        return this.InvestorList.filter((el) => {
          console.log("Search Investors  ", this.searchInvestors);
          return (
            !this.searchInvestors ||
            el.investor_name
              .toLowerCase()
              .indexOf(this.searchInvestors.toLowerCase()) > -1 ||
            el.investor_surname
              .toLowerCase()
              .indexOf(this.searchInvestors.toLowerCase()) > -1 ||
            el.investor_acc_number
              .toLowerCase()
              .indexOf(this.searchInvestors.toLowerCase()) > -1 ||
            el.investor_email
              .toLowerCase()
              .indexOf(this.searchInvestors.toLowerCase()) > -1 ||
            el.investor_id_number
              .toLowerCase()
              .indexOf(this.searchInvestors.toLowerCase()) > -1
          );
        });
      }
    },
  },

  watch: {},

  methods: {
    home() {
      this.$router.push({
        name: "home",       
      });
    },
    create() {
      this.$router.push({
        name: "investoradd",       
      });
    },
    
    viewInvestor(event) {
      console.log(event.currentTarget.id);
      // this.$router.push({})
      this.$router.push({
        //name: "investmentview",
        name: "investorupdate",
        params: { id: event.currentTarget.id },
      });
    },
    viewInvestments(event) {
      console.log(event.currentTarget.id);
      // this.$router.push({})
      this.$router.push({
        name: "investmentview",
        //name: "investorupdate",
        params: { id: event.currentTarget.id },
      });
    },
    refresh() {
      location.reload()
    },
    onResize() {
      this.windowSize = { x: window.innerWidth, y: window.innerHeight };
    },
    openInvestmentUpdate(theEvent) {
      this.SelectedInvestorId = theEvent.srcElement.id;  
      this.openInvestmentViewForm = !this.openInvestmentViewForm;
    },
    closeForm(event) {
      this.openInvestmentUpdateForm = event;
    },

    async getAllInvestors() {
      this.InvetorsList = [];
      let data = {
        id: 1, //   id: this.$store.state.development.id
      };
      await axios({
        method: "post",
        url: `${url}/getAllInvestors`, // use the store url
        data: data,
      })
        .then(
          (response) => {
            response.data.forEach((investor) => {
              this.InvestorList.push(investor);
            });            
          },
          (error) => {
            console.log(error);
          }
        )
        .catch((e) => {
          console.log(e);
        });
    },
  },
};
</script>
